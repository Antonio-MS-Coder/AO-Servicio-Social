"use strict";(self.webpackChunkdoom_mvp=self.webpackChunkdoom_mvp||[]).push([[3856],{3856:(e,r,i)=>{i.r(r),i.d(r,{default:()=>ge});var s=i(9379),t=i(5043),l=i(9981),n=i(4117),a=i(9252),o=i(1637),c=i(6446),d=i(5865),x=i(1906),h=i(3336),A=i(8903),j=i(7784),u=i(1787),p=i(2143),v=i(9413),m=i(4605),g=i(1962),f=i(1828),b=i(4511),y=i(7629),w=i(6641),k=i(8939),C=i(4056),P=i(3933),I=i(5721),S=i(2110),z=i(5537),D=i(3851),E=i(1045),L=i(8734),M=i(3845),N=i(6494),T=i(7739),W=i(7392),R=i(9650),B=i(1806),O=i(4882),_=i(8076),G=i(39),J=i(3460),H=i(9090),U=i(35),X=i(6600),Z=i(5316),q=i(7254),F=i(9347),K=i(9336),V=i(7225),Q=i(1794),Y=i(8606),$=i(1505),ee=i(7968),re=i(6428),ie=i(1082),se=i(889),te=i(9396),le=i(9893),ne=i(513),ae=i(9484),oe=i(9320),ce=i(1774),de=i(8831),xe=i(529),he=i(9345),Ae=i(9509),je=i(6667),ue=i(8836),pe=i(9066),ve=i(6166),me=i(579);const ge=()=>{const{t:e}=(0,n.Bd)(),r=(0,l.Zp)(),{jobId:i}=(0,l.g)(),{currentUser:ge}=(0,pe.A)(),[fe,be]=(0,t.useState)(!0),[ye,we]=(0,t.useState)([]),[ke,Ce]=(0,t.useState)([]),[Pe,Ie]=(0,t.useState)(null),[Se,ze]=(0,t.useState)([]),[De,Ee]=(0,t.useState)(0),[Le,Me]=(0,t.useState)("list"),[Ne,Te]=(0,t.useState)(0),[We,Re]=(0,t.useState)(10),[Be,Oe]=(0,t.useState)({status:"all",experience:[0,20],rating:0,hasMessage:!1,hasCertifications:!1,sortBy:"newest",searchTerm:"",jobId:i||"all"}),[_e,Ge]=(0,t.useState)(!1),[Je,He]=(0,t.useState)(null),[Ue,Xe]=(0,t.useState)(!1),[Ze,qe]=(0,t.useState)(!1),[Fe,Ke]=(0,t.useState)(null),[Ve,Qe]=(0,t.useState)(!1),[Ye,$e]=(0,t.useState)(null),[er,rr]=(0,t.useState)("");(0,t.useEffect)(()=>{ge&&ir()},[ge,i]);const ir=async()=>{if(ge){be(!0);try{const r=(0,je.P)((0,je.rJ)(ue.db,"jobs"),(0,je._M)("employerId","==",ge.uid)),t=(await(0,je.GG)(r)).docs.map(e=>(0,s.A)({id:e.id},e.data()));if(Ce(t),i){const e=t.find(e=>e.id===i);Ie(e||null)}let l;if(i)l=(0,je.P)((0,je.rJ)(ue.db,"applications"),(0,je._M)("jobId","==",i));else{const r=t.map(e=>e.id);if(0===r.length)return we([]),void be(!1);const i=[],l=10;for(let e=0;e<r.length;e+=l){const t=r.slice(e,e+l),n=(0,je.P)((0,je.rJ)(ue.db,"applications"),(0,je._M)("jobId","in",t));(await(0,je.GG)(n)).docs.forEach(e=>{i.push((0,s.A)({id:e.id},e.data()))})}for(const s of i)try{const e=await(0,je.x7)((0,je.H9)(ue.db,"workers",s.workerId));e.exists()&&(s.workerProfile=e.data())}catch(e){console.error("Error fetching worker profile:",e)}we(i)}}catch(e){console.error("Error fetching applications:",e)}finally{be(!1)}}},sr=async(e,r)=>{try{await(0,je.mZ)((0,je.H9)(ue.db,"applications",e),{status:r,updatedAt:je.Dc.now()}),we(ye.map(i=>i.id===e?(0,s.A)((0,s.A)({},i),{},{status:r}):i))}catch(i){console.error("Error updating application status:",i)}},tr=(()=>{const e=(()=>{let e=[...ye];if("all"!==Be.jobId&&(e=e.filter(e=>e.jobId===Be.jobId)),"all"!==Be.status&&(e="shortlisted"===Be.status?e.filter(e=>e.isShortlisted):e.filter(e=>e.status===Be.status)),e=e.filter(e=>{var r;const i=(null===(r=e.workerProfile)||void 0===r?void 0:r.experience)||0;return i>=Be.experience[0]&&i<=Be.experience[1]}),Be.rating>0&&(e=e.filter(e=>{var r;return((null===(r=e.workerProfile)||void 0===r?void 0:r.rating)||0)>=Be.rating})),Be.hasMessage&&(e=e.filter(e=>e.coverLetter&&e.coverLetter.length>0)),Be.hasCertifications&&(e=e.filter(e=>{var r;return(null===(r=e.workerProfile)||void 0===r?void 0:r.certifications)&&e.workerProfile.certifications.length>0})),Be.searchTerm){const r=Be.searchTerm.toLowerCase();e=e.filter(e=>{var i,s,t;return e.workerName.toLowerCase().includes(r)||(null===(i=e.coverLetter)||void 0===i?void 0:i.toLowerCase().includes(r))||(null===(s=e.workerProfile)||void 0===s||null===(t=s.bio)||void 0===t?void 0:t.toLowerCase().includes(r))})}return e.sort((e,r)=>{var i,s,t,l,n,a,o,c,d,x,h,A;switch(Be.sortBy){case"newest":return((null===(i=r.appliedAt)||void 0===i||null===(s=i.toDate)||void 0===s?void 0:s.call(i))||new Date).getTime()-((null===(t=e.appliedAt)||void 0===t||null===(l=t.toDate)||void 0===l?void 0:l.call(t))||new Date).getTime();case"oldest":return((null===(n=e.appliedAt)||void 0===n||null===(a=n.toDate)||void 0===a?void 0:a.call(n))||new Date).getTime()-((null===(o=r.appliedAt)||void 0===o||null===(c=o.toDate)||void 0===c?void 0:c.call(o))||new Date).getTime();case"rating":return((null===(d=r.workerProfile)||void 0===d?void 0:d.rating)||0)-((null===(x=e.workerProfile)||void 0===x?void 0:x.rating)||0);case"experience":return((null===(h=r.workerProfile)||void 0===h?void 0:h.experience)||0)-((null===(A=e.workerProfile)||void 0===A?void 0:A.experience)||0);case"name":return e.workerName.localeCompare(r.workerName);default:return 0}}),e})(),r=e.filter(e=>"pending"===e.status),i=e.filter(e=>"accepted"===e.status),s=e.filter(e=>"rejected"===e.status),t=e.filter(e=>e.isShortlisted);return{all:e,pending:r,accepted:i,rejected:s,shortlisted:t}})(),lr=0===De?tr.all:1===De?tr.pending:2===De?tr.shortlisted:3===De?tr.accepted:tr.rejected;return fe?(0,me.jsx)(a.A,{sx:{py:4,textAlign:"center"},children:(0,me.jsx)(o.A,{})}):(0,me.jsxs)(a.A,{maxWidth:"xl",sx:{py:4},children:[(0,me.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,children:[(0,me.jsx)(d.A,{variant:"h4",children:"Revisar Aplicaciones"}),(0,me.jsxs)(c.A,{display:"flex",gap:2,children:[(0,me.jsx)(x.A,{variant:"outlined",startIcon:(0,me.jsx)(ee.A,{}),onClick:()=>{const e=[["Nombre","Email","Tel\xe9fono","Experiencia","Calificaci\xf3n","Estado","Fecha de Aplicaci\xf3n"],...lr.map(e=>{var r,i,s,t,l;return[e.workerName,(null===(r=e.workerProfile)||void 0===r?void 0:r.userId)||"","",(null===(i=e.workerProfile)||void 0===i?void 0:i.experience)||0,(null===(s=e.workerProfile)||void 0===s?void 0:s.rating)||0,e.status,(null===(t=e.appliedAt)||void 0===t||null===(l=t.toDate)||void 0===l?void 0:l.call(t).toLocaleDateString("es-MX"))||""]})].map(e=>e.join(",")).join("\n"),r=new Blob([e],{type:"text/csv"}),i=window.URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download="applications-".concat((new Date).toISOString(),".csv"),s.click()},children:"Exportar"}),(0,me.jsx)(x.A,{variant:"outlined",startIcon:(0,me.jsx)(ne.A,{}),onClick:()=>window.print(),children:"Imprimir"}),(0,me.jsxs)(x.A,{variant:"contained",startIcon:(0,me.jsx)($.A,{}),onClick:()=>Xe(!0),disabled:Se.length<2,children:["Comparar (",Se.length,")"]})]})]}),(0,me.jsxs)(h.A,{sx:{p:3,mb:3},children:[(0,me.jsxs)(A.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,me.jsx)(A.Ay,{item:!0,xs:12,md:3,children:(0,me.jsx)(j.A,{fullWidth:!0,placeholder:"Buscar por nombre o mensaje...",value:Be.searchTerm,onChange:e=>Oe((0,s.A)((0,s.A)({},Be),{},{searchTerm:e.target.value})),InputProps:{startAdornment:(0,me.jsx)(u.A,{position:"start",children:(0,me.jsx)(ae.A,{})})}})}),(0,me.jsx)(A.Ay,{item:!0,xs:12,md:2,children:(0,me.jsxs)(j.A,{fullWidth:!0,select:!0,label:"Trabajo",value:Be.jobId,onChange:e=>Oe((0,s.A)((0,s.A)({},Be),{},{jobId:e.target.value})),children:[(0,me.jsx)(p.A,{value:"all",children:"Todos los trabajos"}),ke.map(e=>(0,me.jsx)(p.A,{value:e.id,children:e.title},e.id))]})}),(0,me.jsx)(A.Ay,{item:!0,xs:12,md:2,children:(0,me.jsxs)(j.A,{fullWidth:!0,select:!0,label:"Estado",value:Be.status,onChange:e=>Oe((0,s.A)((0,s.A)({},Be),{},{status:e.target.value})),children:[(0,me.jsx)(p.A,{value:"all",children:"Todos"}),(0,me.jsx)(p.A,{value:"pending",children:"Pendientes"}),(0,me.jsx)(p.A,{value:"shortlisted",children:"Preseleccionados"}),(0,me.jsx)(p.A,{value:"accepted",children:"Aceptados"}),(0,me.jsx)(p.A,{value:"rejected",children:"Rechazados"})]})}),(0,me.jsx)(A.Ay,{item:!0,xs:12,md:2,children:(0,me.jsxs)(j.A,{fullWidth:!0,select:!0,label:"Ordenar por",value:Be.sortBy,onChange:e=>Oe((0,s.A)((0,s.A)({},Be),{},{sortBy:e.target.value})),children:[(0,me.jsx)(p.A,{value:"newest",children:"M\xe1s recientes"}),(0,me.jsx)(p.A,{value:"oldest",children:"M\xe1s antiguos"}),(0,me.jsx)(p.A,{value:"rating",children:"Calificaci\xf3n"}),(0,me.jsx)(p.A,{value:"experience",children:"Experiencia"}),(0,me.jsx)(p.A,{value:"name",children:"Nombre"})]})}),(0,me.jsx)(A.Ay,{item:!0,xs:12,md:1,children:(0,me.jsx)(v.A,{children:(0,me.jsx)(m.A,{control:(0,me.jsx)(g.A,{checked:Be.hasMessage,onChange:e=>Oe((0,s.A)((0,s.A)({},Be),{},{hasMessage:e.target.checked}))}),label:"Con mensaje"})})}),(0,me.jsx)(A.Ay,{item:!0,xs:12,md:1,children:(0,me.jsx)(v.A,{children:(0,me.jsx)(m.A,{control:(0,me.jsx)(g.A,{checked:Be.hasCertifications,onChange:e=>Oe((0,s.A)((0,s.A)({},Be),{},{hasCertifications:e.target.checked}))}),label:"Certificados"})})}),(0,me.jsx)(A.Ay,{item:!0,xs:12,md:1,children:(0,me.jsxs)(f.A,{value:Le,exclusive:!0,onChange:(e,r)=>r&&Me(r),size:"small",children:[(0,me.jsx)(b.A,{value:"list",children:(0,me.jsx)(xe.A,{})}),(0,me.jsx)(b.A,{value:"grid",children:(0,me.jsx)(he.A,{})}),(0,me.jsx)(b.A,{value:"table",children:(0,me.jsx)(re.A,{})})]})})]}),(0,me.jsxs)(c.A,{sx:{mt:2},children:[(0,me.jsxs)(d.A,{variant:"body2",gutterBottom:!0,children:["Experiencia: ",Be.experience[0]," - ",Be.experience[1]," a\xf1os"]}),(0,me.jsx)(y.Ay,{value:Be.experience,onChange:(e,r)=>Oe((0,s.A)((0,s.A)({},Be),{},{experience:r})),valueLabelDisplay:"auto",min:0,max:20,marks:[{value:0,label:"0"},{value:5,label:"5"},{value:10,label:"10"},{value:15,label:"15"},{value:20,label:"20+"}]}),(0,me.jsxs)(c.A,{display:"flex",alignItems:"center",gap:2,mt:2,children:[(0,me.jsx)(d.A,{variant:"body2",children:"Calificaci\xf3n m\xednima:"}),(0,me.jsx)(w.A,{value:Be.rating,onChange:(e,r)=>Oe((0,s.A)((0,s.A)({},Be),{},{rating:r||0}))}),Be.rating>0&&(0,me.jsx)(x.A,{size:"small",onClick:()=>Oe((0,s.A)((0,s.A)({},Be),{},{rating:0})),children:"Limpiar"})]})]})]}),Se.length>0&&(0,me.jsx)(h.A,{sx:{p:2,mb:2},children:(0,me.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,me.jsxs)(d.A,{children:[Se.length," aplicaciones seleccionadas"]}),(0,me.jsxs)(c.A,{display:"flex",gap:2,children:[(0,me.jsx)(x.A,{variant:"contained",color:"success",startIcon:(0,me.jsx)(de.A,{}),onClick:()=>{He("accept"),Ge(!0)},children:"Aceptar"}),(0,me.jsx)(x.A,{variant:"contained",color:"error",startIcon:(0,me.jsx)(ce.A,{}),onClick:()=>{He("reject"),Ge(!0)},children:"Rechazar"}),(0,me.jsx)(x.A,{variant:"contained",color:"warning",startIcon:(0,me.jsx)(oe.A,{}),onClick:()=>{He("shortlist"),Ge(!0)},children:"Preseleccionar"}),(0,me.jsx)(x.A,{variant:"outlined",onClick:()=>ze([]),children:"Limpiar selecci\xf3n"})]})]})}),(0,me.jsx)(h.A,{sx:{mb:3},children:(0,me.jsxs)(k.A,{value:De,onChange:(e,r)=>Ee(r),children:[(0,me.jsx)(C.A,{label:(0,me.jsx)(P.A,{badgeContent:tr.all.length,color:"primary",children:(0,me.jsx)(c.A,{sx:{pr:2},children:"Todas"})})}),(0,me.jsx)(C.A,{label:(0,me.jsx)(P.A,{badgeContent:tr.pending.length,color:"warning",children:(0,me.jsx)(c.A,{sx:{pr:2},children:"Pendientes"})})}),(0,me.jsx)(C.A,{label:(0,me.jsx)(P.A,{badgeContent:tr.shortlisted.length,color:"info",children:(0,me.jsx)(c.A,{sx:{pr:2},children:"Preseleccionadas"})})}),(0,me.jsx)(C.A,{label:(0,me.jsx)(P.A,{badgeContent:tr.accepted.length,color:"success",children:(0,me.jsx)(c.A,{sx:{pr:2},children:"Aceptadas"})})}),(0,me.jsx)(C.A,{label:(0,me.jsx)(P.A,{badgeContent:tr.rejected.length,color:"error",children:(0,me.jsx)(c.A,{sx:{pr:2},children:"Rechazadas"})})})]})}),0===lr.length?(0,me.jsxs)(h.A,{sx:{p:4,textAlign:"center"},children:[(0,me.jsx)(d.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No hay aplicaciones para mostrar"}),(0,me.jsx)(d.A,{variant:"body2",color:"text.secondary",children:Be.searchTerm||"all"!==Be.status?"Intenta ajustar tus filtros de b\xfasqueda":"Las nuevas aplicaciones aparecer\xe1n aqu\xed"})]}):(0,me.jsxs)(me.Fragment,{children:["list"===Le&&(0,me.jsx)(I.A,{children:lr.slice(Ne*We,Ne*We+We).map(e=>{var i,s,t,l,n,a;return(0,me.jsx)(S.A,{sx:{mb:2},children:(0,me.jsxs)(z.Ay,{children:[(0,me.jsx)(g.A,{checked:Se.includes(e.id),onChange:r=>{r.target.checked?ze([...Se,e.id]):ze(Se.filter(r=>r!==e.id))}}),(0,me.jsx)(D.A,{children:(0,me.jsx)(E.A,{src:e.workerPhoto,sx:{width:56,height:56},children:(0,me.jsx)(le.A,{})})}),(0,me.jsx)(L.A,{primary:(0,me.jsxs)(c.A,{display:"flex",alignItems:"center",gap:1,children:[(0,me.jsx)(d.A,{variant:"h6",children:e.workerName}),e.isShortlisted&&(0,me.jsx)(M.A,{size:"small",label:"Preseleccionado",color:"warning",icon:(0,me.jsx)(oe.A,{})}),(0,me.jsx)(M.A,{size:"small",label:e.status,color:"pending"===e.status?"default":"accepted"===e.status?"success":"error"})]}),secondary:(0,me.jsxs)(c.A,{sx:{mt:1},children:[(0,me.jsxs)(A.Ay,{container:!0,spacing:2,children:[(0,me.jsxs)(A.Ay,{item:!0,xs:12,md:6,children:[(0,me.jsxs)(c.A,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,me.jsx)(Ae.A,{fontSize:"small"}),(0,me.jsxs)(d.A,{variant:"body2",children:[null===(i=e.workerProfile)||void 0===i?void 0:i.trade," \u2022 ",(null===(s=e.workerProfile)||void 0===s?void 0:s.experience)||0," a\xf1os exp."]})]}),(0,me.jsxs)(c.A,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,me.jsx)(ie.A,{fontSize:"small"}),(0,me.jsx)(d.A,{variant:"body2",children:(null===(t=e.workerProfile)||void 0===t?void 0:t.location)||"No especificado"})]}),(null===(l=e.workerProfile)||void 0===l?void 0:l.rating)&&(0,me.jsxs)(c.A,{display:"flex",alignItems:"center",gap:1,children:[(0,me.jsx)(w.A,{value:e.workerProfile.rating,readOnly:!0,size:"small"}),(0,me.jsxs)(d.A,{variant:"body2",children:["(",e.workerProfile.totalRatings," rese\xf1as)"]})]})]}),(0,me.jsxs)(A.Ay,{item:!0,xs:12,md:6,children:[e.coverLetter&&(0,me.jsx)(c.A,{mb:1,children:(0,me.jsxs)(d.A,{variant:"body2",color:"text.secondary",children:['"',e.coverLetter,'"']})}),(0,me.jsxs)(d.A,{variant:"caption",color:"text.secondary",children:["Aplic\xf3: ",null===(n=e.appliedAt)||void 0===n||null===(a=n.toDate)||void 0===a?void 0:a.call(n).toLocaleDateString("es-MX")]})]})]}),(0,me.jsxs)(c.A,{display:"flex",gap:1,mt:2,children:[(0,me.jsx)(x.A,{size:"small",variant:"contained",color:"success",startIcon:(0,me.jsx)(Y.A,{}),onClick:()=>sr(e.id,"accepted"),disabled:"accepted"===e.status,children:"Aceptar"}),(0,me.jsx)(x.A,{size:"small",variant:"contained",color:"error",startIcon:(0,me.jsx)(Q.A,{}),onClick:()=>sr(e.id,"rejected"),disabled:"rejected"===e.status,children:"Rechazar"}),(0,me.jsx)(x.A,{size:"small",variant:"outlined",startIcon:(0,me.jsx)(se.A,{}),onClick:()=>{Ke({id:e.workerId,name:e.workerName,photo:e.workerPhoto}),qe(!0)},children:"Mensaje"}),(0,me.jsx)(x.A,{size:"small",variant:"outlined",startIcon:(0,me.jsx)(V.A,{}),children:"Agendar"}),(0,me.jsx)(x.A,{size:"small",variant:"outlined",startIcon:(0,me.jsx)(te.A,{}),onClick:()=>{$e(e),rr(e.notes||""),Qe(!0)},children:"Notas"}),(0,me.jsx)(x.A,{size:"small",variant:"outlined",onClick:()=>r("/workers/".concat(e.workerId)),children:"Ver Perfil"})]})]})})]})},e.id)})}),"grid"===Le&&(0,me.jsx)(A.Ay,{container:!0,spacing:3,children:lr.slice(Ne*We,Ne*We+We).map(e=>{var i,s,t,l,n;return(0,me.jsx)(A.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,me.jsxs)(S.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,me.jsxs)(N.A,{sx:{flex:1},children:[(0,me.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[(0,me.jsx)(g.A,{checked:Se.includes(e.id),onChange:r=>{r.target.checked?ze([...Se,e.id]):ze(Se.filter(r=>r!==e.id))}}),(0,me.jsx)(E.A,{src:e.workerPhoto,sx:{width:64,height:64},children:(0,me.jsx)(le.A,{})}),(0,me.jsx)(c.A,{children:e.isShortlisted&&(0,me.jsx)(T.A,{title:"Preseleccionado",children:(0,me.jsx)(oe.A,{sx:{color:"warning.main"}})})})]}),(0,me.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:e.workerName}),(0,me.jsx)(M.A,{size:"small",label:e.status,color:"pending"===e.status?"default":"accepted"===e.status?"success":"error",sx:{mb:2}}),(0,me.jsx)(c.A,{mb:1,children:(0,me.jsxs)(d.A,{variant:"body2",color:"text.secondary",children:[null===(i=e.workerProfile)||void 0===i?void 0:i.trade," \u2022 ",(null===(s=e.workerProfile)||void 0===s?void 0:s.experience)||0," a\xf1os"]})}),(null===(t=e.workerProfile)||void 0===t?void 0:t.rating)&&(0,me.jsxs)(c.A,{display:"flex",alignItems:"center",gap:.5,mb:1,children:[(0,me.jsx)(w.A,{value:e.workerProfile.rating,readOnly:!0,size:"small"}),(0,me.jsxs)(d.A,{variant:"caption",children:["(",e.workerProfile.totalRatings,")"]})]}),e.coverLetter&&(0,me.jsxs)(d.A,{variant:"body2",color:"text.secondary",sx:{mb:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:['"',e.coverLetter,'"']}),(0,me.jsx)(d.A,{variant:"caption",color:"text.secondary",children:null===(l=e.appliedAt)||void 0===l||null===(n=l.toDate)||void 0===n?void 0:n.call(l).toLocaleDateString("es-MX")})]}),(0,me.jsxs)(c.A,{sx:{p:2,pt:0,display:"flex",gap:1,flexWrap:"wrap"},children:[(0,me.jsx)(W.A,{color:"success",onClick:()=>sr(e.id,"accepted"),disabled:"accepted"===e.status,children:(0,me.jsx)(Y.A,{})}),(0,me.jsx)(W.A,{color:"error",onClick:()=>sr(e.id,"rejected"),disabled:"rejected"===e.status,children:(0,me.jsx)(Q.A,{})}),(0,me.jsx)(W.A,{color:"primary",onClick:()=>{Ke({id:e.workerId,name:e.workerName,photo:e.workerPhoto}),qe(!0)},children:(0,me.jsx)(se.A,{})}),(0,me.jsx)(W.A,{onClick:()=>r("/workers/".concat(e.workerId)),children:(0,me.jsx)(le.A,{})})]})]})},e.id)})}),"table"===Le&&(0,me.jsxs)(R.A,{component:h.A,children:[(0,me.jsxs)(B.A,{children:[(0,me.jsx)(O.A,{children:(0,me.jsxs)(_.A,{children:[(0,me.jsx)(G.A,{padding:"checkbox",children:(0,me.jsx)(g.A,{indeterminate:Se.length>0&&Se.length<lr.length,checked:lr.length>0&&Se.length===lr.length,onChange:e=>{e.target.checked?ze(lr.map(e=>e.id)):ze([])}})}),(0,me.jsx)(G.A,{children:"Candidato"}),(0,me.jsx)(G.A,{children:"Experiencia"}),(0,me.jsx)(G.A,{children:"Calificaci\xf3n"}),(0,me.jsx)(G.A,{children:"Estado"}),(0,me.jsx)(G.A,{children:"Fecha"}),(0,me.jsx)(G.A,{children:"Acciones"})]})}),(0,me.jsx)(J.A,{children:lr.slice(Ne*We,Ne*We+We).map(e=>{var r,i,s,t,l;return(0,me.jsxs)(_.A,{children:[(0,me.jsx)(G.A,{padding:"checkbox",children:(0,me.jsx)(g.A,{checked:Se.includes(e.id),onChange:r=>{r.target.checked?ze([...Se,e.id]):ze(Se.filter(r=>r!==e.id))}})}),(0,me.jsx)(G.A,{children:(0,me.jsxs)(c.A,{display:"flex",alignItems:"center",gap:1,children:[(0,me.jsx)(E.A,{src:e.workerPhoto,sx:{width:32,height:32},children:(0,me.jsx)(le.A,{})}),(0,me.jsxs)(c.A,{children:[(0,me.jsx)(d.A,{variant:"body2",children:e.workerName}),(0,me.jsx)(d.A,{variant:"caption",color:"text.secondary",children:null===(r=e.workerProfile)||void 0===r?void 0:r.trade})]}),e.isShortlisted&&(0,me.jsx)(oe.A,{sx:{color:"warning.main",fontSize:16}})]})}),(0,me.jsxs)(G.A,{children:[(null===(i=e.workerProfile)||void 0===i?void 0:i.experience)||0," a\xf1os"]}),(0,me.jsx)(G.A,{children:null!==(s=e.workerProfile)&&void 0!==s&&s.rating?(0,me.jsxs)(c.A,{display:"flex",alignItems:"center",gap:.5,children:[(0,me.jsx)(w.A,{value:e.workerProfile.rating,readOnly:!0,size:"small"}),(0,me.jsxs)(d.A,{variant:"caption",children:["(",e.workerProfile.totalRatings,")"]})]}):"-"}),(0,me.jsx)(G.A,{children:(0,me.jsx)(M.A,{size:"small",label:e.status,color:"pending"===e.status?"default":"accepted"===e.status?"success":"error"})}),(0,me.jsx)(G.A,{children:null===(t=e.appliedAt)||void 0===t||null===(l=t.toDate)||void 0===l?void 0:l.call(t).toLocaleDateString("es-MX")}),(0,me.jsx)(G.A,{children:(0,me.jsxs)(c.A,{display:"flex",gap:1,children:[(0,me.jsx)(W.A,{size:"small",color:"success",onClick:()=>sr(e.id,"accepted"),disabled:"accepted"===e.status,children:(0,me.jsx)(Y.A,{fontSize:"small"})}),(0,me.jsx)(W.A,{size:"small",color:"error",onClick:()=>sr(e.id,"rejected"),disabled:"rejected"===e.status,children:(0,me.jsx)(Q.A,{fontSize:"small"})}),(0,me.jsx)(W.A,{size:"small",color:"primary",onClick:()=>{Ke({id:e.workerId,name:e.workerName,photo:e.workerPhoto}),qe(!0)},children:(0,me.jsx)(se.A,{fontSize:"small"})})]})})]},e.id)})})]}),(0,me.jsx)(H.A,{component:"div",count:lr.length,page:Ne,onPageChange:(e,r)=>Te(r),rowsPerPage:We,onRowsPerPageChange:e=>{Re(parseInt(e.target.value,10)),Te(0)}})]})]}),(0,me.jsxs)(U.A,{open:_e,onClose:()=>Ge(!1),children:[(0,me.jsx)(X.A,{children:"Confirmar Acci\xf3n en Lote"}),(0,me.jsxs)(Z.A,{children:[(0,me.jsxs)(q.A,{severity:"warning",sx:{mb:2},children:["Esta acci\xf3n afectar\xe1 a ",Se.length," aplicaciones"]}),(0,me.jsxs)(d.A,{children:["\xbfEst\xe1s seguro de que deseas ","accept"===Je?"aceptar":"reject"===Je?"rechazar":"preseleccionar"," las aplicaciones seleccionadas?"]})]}),(0,me.jsxs)(F.A,{children:[(0,me.jsx)(x.A,{onClick:()=>Ge(!1),children:"Cancelar"}),(0,me.jsx)(x.A,{onClick:async()=>{if(Je&&0!==Se.length)try{const e=(0,je.wP)(ue.db);Se.forEach(r=>{const i=(0,je.H9)(ue.db,"applications",r);"shortlist"===Je?e.update(i,{isShortlisted:!0,updatedAt:je.Dc.now()}):e.update(i,{status:"accept"===Je?"accepted":"rejected",updatedAt:je.Dc.now()})}),await e.commit(),we(ye.map(e=>Se.includes(e.id)?"shortlist"===Je?(0,s.A)((0,s.A)({},e),{},{isShortlisted:!0}):(0,s.A)((0,s.A)({},e),{},{status:"accept"===Je?"accepted":"rejected"}):e)),ze([]),Ge(!1),He(null)}catch(e){console.error("Error performing bulk action:",e)}},variant:"contained",color:"accept"===Je?"success":"reject"===Je?"error":"warning",children:"Confirmar"})]})]}),(0,me.jsxs)(U.A,{open:Ve,onClose:()=>Qe(!1),maxWidth:"sm",fullWidth:!0,children:[(0,me.jsxs)(X.A,{children:["Notas para ",null===Ye||void 0===Ye?void 0:Ye.workerName]}),(0,me.jsx)(Z.A,{children:(0,me.jsx)(j.A,{fullWidth:!0,multiline:!0,rows:4,value:er,onChange:e=>rr(e.target.value),placeholder:"Escribe tus notas sobre este candidato...",sx:{mt:2}})}),(0,me.jsxs)(F.A,{children:[(0,me.jsx)(x.A,{onClick:()=>Qe(!1),children:"Cancelar"}),(0,me.jsx)(x.A,{onClick:async()=>{if(Ye)try{await(0,je.mZ)((0,je.H9)(ue.db,"applications",Ye.id),{notes:er,updatedAt:je.Dc.now()}),we(ye.map(e=>e.id===Ye.id?(0,s.A)((0,s.A)({},e),{},{notes:er}):e)),Qe(!1),$e(null),rr("")}catch(e){console.error("Error saving notes:",e)}},variant:"contained",children:"Guardar"})]})]}),Fe&&(0,me.jsx)(ve.A,{open:Ze,onClose:()=>qe(!1),recipientId:Fe.id,recipientName:Fe.name,recipientPhoto:Fe.photo,jobId:i,jobTitle:null===Pe||void 0===Pe?void 0:Pe.title}),(0,me.jsxs)(U.A,{open:Ue,onClose:()=>Xe(!1),maxWidth:"lg",fullWidth:!0,children:[(0,me.jsx)(X.A,{children:"Comparar Candidatos"}),(0,me.jsx)(Z.A,{children:(0,me.jsx)(A.Ay,{container:!0,spacing:2,children:Se.map(e=>{var r,i,s,t,l,n;const a=ye.find(r=>r.id===e);return a?(0,me.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,me.jsxs)(S.A,{sx:{p:2},children:[(0,me.jsxs)(c.A,{display:"flex",alignItems:"center",gap:2,mb:2,children:[(0,me.jsx)(E.A,{src:a.workerPhoto,sx:{width:48,height:48},children:(0,me.jsx)(le.A,{})}),(0,me.jsxs)(c.A,{flex:1,children:[(0,me.jsx)(d.A,{variant:"h6",children:a.workerName}),(0,me.jsx)(d.A,{variant:"body2",color:"text.secondary",children:null===(r=a.workerProfile)||void 0===r?void 0:r.trade})]})]}),(0,me.jsx)(K.A,{sx:{mb:2}}),(0,me.jsxs)(A.Ay,{container:!0,spacing:1,children:[(0,me.jsxs)(A.Ay,{item:!0,xs:6,children:[(0,me.jsx)(d.A,{variant:"caption",color:"text.secondary",children:"Experiencia"}),(0,me.jsxs)(d.A,{variant:"body2",children:[(null===(i=a.workerProfile)||void 0===i?void 0:i.experience)||0," a\xf1os"]})]}),(0,me.jsxs)(A.Ay,{item:!0,xs:6,children:[(0,me.jsx)(d.A,{variant:"caption",color:"text.secondary",children:"Calificaci\xf3n"}),(0,me.jsx)(c.A,{display:"flex",alignItems:"center",children:(0,me.jsx)(w.A,{value:(null===(s=a.workerProfile)||void 0===s?void 0:s.rating)||0,readOnly:!0,size:"small"})})]}),(0,me.jsxs)(A.Ay,{item:!0,xs:6,children:[(0,me.jsx)(d.A,{variant:"caption",color:"text.secondary",children:"Certificaciones"}),(0,me.jsx)(d.A,{variant:"body2",children:(null===(t=a.workerProfile)||void 0===t||null===(l=t.certifications)||void 0===l?void 0:l.length)||0})]}),(0,me.jsxs)(A.Ay,{item:!0,xs:6,children:[(0,me.jsx)(d.A,{variant:"caption",color:"text.secondary",children:"Disponible"}),(0,me.jsx)(d.A,{variant:"body2",children:null!==(n=a.workerProfile)&&void 0!==n&&n.available?"S\xed":"No"})]})]}),a.coverLetter&&(0,me.jsxs)(c.A,{mt:2,children:[(0,me.jsx)(d.A,{variant:"caption",color:"text.secondary",children:"Carta de presentaci\xf3n"}),(0,me.jsxs)(d.A,{variant:"body2",children:['"',a.coverLetter,'"']})]})]})},e):null})})}),(0,me.jsx)(F.A,{children:(0,me.jsx)(x.A,{onClick:()=>Xe(!1),children:"Cerrar"})})]})]})}},6166:(e,r,i)=>{i.d(r,{A:()=>P});var s=i(9379),t=i(5043),l=i(35),n=i(6600),a=i(6446),o=i(1045),c=i(5865),d=i(7392),x=i(5316),h=i(1637),A=i(3336),j=i(9347),u=i(7784),p=i(8606),v=i(3438),m=i(1209),g=i(5874),f=i(6667),b=i(8836),y=i(9066),w=i(4399),k=i(4057),C=i(579);const P=e=>{let{open:r,onClose:i,recipientId:P,recipientName:I,recipientPhoto:S,jobId:z,jobTitle:D}=e;const{currentUser:E}=(0,y.A)(),[L,M]=(0,t.useState)([]),[N,T]=(0,t.useState)(""),[W,R]=(0,t.useState)(!0),[B,O]=(0,t.useState)(!1),_=(0,t.useRef)(null);(0,t.useEffect)(()=>{if(!r||!E)return;R(!0);const e=[E.uid,P].sort().join("_"),i=(0,f.P)((0,f.rJ)(b.db,"messages"),(0,f._M)("conversationId","==",e),(0,f.My)("timestamp","asc")),t=(0,f.aQ)(i,e=>{const r=[];e.forEach(e=>{r.push((0,s.A)({id:e.id},e.data()))}),M(r),R(!1),J()});return()=>t()},[r,E,P]),(0,t.useEffect)(()=>{G()},[L]);const G=()=>{var e;null===(e=_.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},J=async()=>{if(!E)return;const e=(0,f.P)((0,f.rJ)(b.db,"messages"),(0,f._M)("recipientId","==",E.uid),(0,f._M)("senderId","==",P),(0,f._M)("read","==",!1));(await(0,f.GG)(e)).forEach(async e=>{await(0,f.mZ)((0,f.H9)(b.db,"messages",e.id),{read:!0})})},H=async()=>{if(N.trim()&&E&&!B){O(!0);try{const e=[E.uid,P].sort().join("_");await(0,f.gS)((0,f.rJ)(b.db,"messages"),{conversationId:e,senderId:E.uid,recipientId:P,content:N.trim(),timestamp:(0,f.O5)(),read:!1,jobId:z||null}),await(0,f.gS)((0,f.rJ)(b.db,"conversations"),{participants:[E.uid,P],lastMessage:N.trim(),lastMessageTime:(0,f.O5)(),jobId:z||null,jobTitle:D||null}),T("")}catch(e){console.error("Error sending message:",e)}finally{O(!1)}}},U=e=>{if(!e)return"";const r=e.toDate?e.toDate():new Date(e);return(0,w.m)(r,{addSuffix:!0,locale:k.es})};return(0,C.jsxs)(l.A,{open:r,onClose:i,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{height:"70vh",display:"flex",flexDirection:"column"}},children:[(0,C.jsx)(n.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,C.jsxs)(a.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,C.jsxs)(a.A,{display:"flex",alignItems:"center",gap:2,children:[(0,C.jsx)(o.A,{src:S,alt:I,children:I[0]}),(0,C.jsxs)(a.A,{children:[(0,C.jsx)(c.A,{variant:"h6",children:I}),D&&(0,C.jsx)(c.A,{variant:"caption",color:"text.secondary",children:D})]})]}),(0,C.jsx)(d.A,{onClick:i,children:(0,C.jsx)(v.A,{})})]})}),(0,C.jsx)(x.A,{sx:{flex:1,overflow:"auto",p:2},children:W?(0,C.jsx)(a.A,{display:"flex",justifyContent:"center",p:4,children:(0,C.jsx)(h.A,{})}):0===L.length?(0,C.jsx)(a.A,{textAlign:"center",p:4,children:(0,C.jsx)(c.A,{color:"text.secondary",children:"Inicia la conversaci\xf3n con un mensaje"})}):(0,C.jsxs)(a.A,{children:[L.map(e=>{const r=e.senderId===(null===E||void 0===E?void 0:E.uid);return(0,C.jsx)(a.A,{display:"flex",justifyContent:r?"flex-end":"flex-start",mb:2,children:(0,C.jsxs)(A.A,{elevation:1,sx:{p:1.5,maxWidth:"70%",bgcolor:r?"primary.main":"grey.100",color:r?"white":"text.primary"},children:[(0,C.jsx)(c.A,{variant:"body2",children:e.content}),(0,C.jsxs)(a.A,{display:"flex",alignItems:"center",gap:.5,mt:.5,children:[(0,C.jsx)(c.A,{variant:"caption",sx:{opacity:.7,color:r?"white":"text.secondary"},children:U(e.timestamp)}),r&&(e.read?(0,C.jsx)(p.A,{sx:{fontSize:14}}):(0,C.jsx)(m.A,{sx:{fontSize:14}}))]})]})},e.id)}),(0,C.jsx)("div",{ref:_})]})}),(0,C.jsx)(j.A,{sx:{p:2,borderTop:1,borderColor:"divider"},children:(0,C.jsx)(u.A,{fullWidth:!0,variant:"outlined",placeholder:"Escribe un mensaje...",value:N,onChange:e=>T(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),H())},multiline:!0,maxRows:3,disabled:B,InputProps:{endAdornment:(0,C.jsx)(d.A,{onClick:H,disabled:!N.trim()||B,color:"primary",children:(0,C.jsx)(g.A,{})})}})})]})}}}]);
//# sourceMappingURL=3856.b8d32630.chunk.js.map