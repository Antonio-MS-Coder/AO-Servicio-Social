"use strict";(self.webpackChunkdoom_mvp=self.webpackChunkdoom_mvp||[]).push([[643],{7643:(e,s,r)=>{r.r(s),r.d(s,{default:()=>X});var i=r(9379),l=r(5043),a=r(3845),o=r(9252),t=r(6446),n=r(5865),c=r(8903),d=r(2110),x=r(6494),h=r(3336),m=r(7784),A=r(1787),j=r(3193),u=r(9190),p=r(2221),y=r(2143),v=r(1906),b=r(9650),f=r(1806),g=r(4882),k=r(8076),w=r(39),C=r(3460),E=r(1045),P=r(7739),N=r(7392),G=r(9090),S=r(35),q=r(6600),B=r(5316),I=r(9347),M=r(794),R=r(7254),T=r(8362),L=r(751),z=r(8606),U=r(1387),W=r(7968),D=r(3560),_=r(4190),F=r(9484),H=r(8440),J=r(4642),O=r(6667),V=r(8836),Z=r(9581),K=r(4057),Q=r(579);const X=()=>{const[e,s]=(0,l.useState)([]),[r,X]=(0,l.useState)([]),[Y,$]=(0,l.useState)(!0),[ee,se]=(0,l.useState)(0),[re,ie]=(0,l.useState)(10),[le,ae]=(0,l.useState)(""),[oe,te]=(0,l.useState)("all"),[ne,ce]=(0,l.useState)("all"),[de,xe]=(0,l.useState)(null),[he,me]=(0,l.useState)(!1),[Ae,je]=(0,l.useState)(!1),[ue,pe]=(0,l.useState)("block"),[ye,ve]=(0,l.useState)({open:!1,message:"",severity:"success"});(0,l.useEffect)(()=>{be()},[]),(0,l.useEffect)(()=>{fe()},[e,le,oe,ne]);const be=async()=>{try{$(!0);const r=await(0,O.GG)((0,O.rJ)(V.db,"users")),l=[];for(const s of r.docs){const r=s.data();let a={};if("worker"===r.role){const r=(0,O.P)((0,O.rJ)(V.db,"workerProfiles"),(0,O._M)("userId","==",s.id)),i=await(0,O.GG)(r);if(!i.empty){var e;const s=i.docs[0].data();a={trade:s.trade,experience:s.experience,rating:s.rating||0,certifications:(null===(e=s.certifications)||void 0===e?void 0:e.length)||0}}}else if("employer"===r.role){const e=(0,O.P)((0,O.rJ)(V.db,"employerProfiles"),(0,O._M)("userId","==",s.id)),r=await(0,O.GG)(e);if(!r.empty){const e=r.docs[0].data();a={companyName:e.companyName,businessType:e.businessType,verified:e.verified||!1}}}l.push((0,i.A)({id:s.id,email:r.email,displayName:r.displayName,phone:r.phone,role:r.role,status:r.status||"active",createdAt:r.createdAt,lastLogin:r.lastLogin,profileComplete:r.profileComplete},a))}s(l)}catch(r){console.error("Error fetching users:",r),ve({open:!0,message:"Error al cargar usuarios",severity:"error"})}finally{$(!1)}},fe=()=>{let s=[...e];le&&(s=s.filter(e=>{var s,r;return e.email.toLowerCase().includes(le.toLowerCase())||(null===(s=e.displayName)||void 0===s?void 0:s.toLowerCase().includes(le.toLowerCase()))||(null===(r=e.companyName)||void 0===r?void 0:r.toLowerCase().includes(le.toLowerCase()))})),"all"!==oe&&(s=s.filter(e=>e.role===oe)),"all"!==ne&&(s=s.filter(e=>e.status===ne)),X(s)},ge=(e,s)=>{xe(e),pe(s),je(!0)},ke=e=>{const s={worker:{label:"Trabajador",color:"primary"},employer:{label:"Empleador",color:"secondary"},admin:{label:"Admin",color:"error"}}[e]||{label:e,color:"default"};return(0,Q.jsx)(a.A,{label:s.label,color:s.color,size:"small"})},we=e=>{const s={active:{label:"Activo",color:"success",icon:(0,Q.jsx)(z.A,{})},blocked:{label:"Bloqueado",color:"error",icon:(0,Q.jsx)(L.A,{})},pending:{label:"Pendiente",color:"warning",icon:(0,Q.jsx)(J.A,{})}}[e]||{label:e,color:"default"};return(0,Q.jsx)(a.A,{label:s.label,color:s.color,size:"small",icon:s.icon})};return(0,Q.jsxs)(o.A,{maxWidth:"xl",sx:{mt:4,mb:4},children:[(0,Q.jsxs)(t.A,{sx:{mb:4},children:[(0,Q.jsxs)(n.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Q.jsx)(T.A,{sx:{fontSize:40,color:"#007A33"}}),"Gesti\xf3n de Usuarios"]}),(0,Q.jsx)(n.A,{variant:"body1",color:"text.secondary",children:"Administra usuarios, verifica empresas y gestiona permisos"})]}),(0,Q.jsxs)(c.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,Q.jsx)(c.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,Q.jsx)(d.A,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:(0,Q.jsxs)(x.A,{children:[(0,Q.jsx)(n.A,{color:"white",variant:"h6",children:"Total Usuarios"}),(0,Q.jsx)(n.A,{color:"white",variant:"h3",children:e.length})]})})}),(0,Q.jsx)(c.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,Q.jsx)(d.A,{sx:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},children:(0,Q.jsxs)(x.A,{children:[(0,Q.jsx)(n.A,{color:"white",variant:"h6",children:"Trabajadores"}),(0,Q.jsx)(n.A,{color:"white",variant:"h3",children:e.filter(e=>"worker"===e.role).length})]})})}),(0,Q.jsx)(c.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,Q.jsx)(d.A,{sx:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},children:(0,Q.jsxs)(x.A,{children:[(0,Q.jsx)(n.A,{color:"white",variant:"h6",children:"Empleadores"}),(0,Q.jsx)(n.A,{color:"white",variant:"h3",children:e.filter(e=>"employer"===e.role).length})]})})}),(0,Q.jsx)(c.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,Q.jsx)(d.A,{sx:{background:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"},children:(0,Q.jsxs)(x.A,{children:[(0,Q.jsx)(n.A,{color:"white",variant:"h6",children:"Activos"}),(0,Q.jsx)(n.A,{color:"white",variant:"h3",children:e.filter(e=>"active"===e.status).length})]})})})]}),(0,Q.jsx)(h.A,{sx:{p:3,mb:3},children:(0,Q.jsxs)(c.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,Q.jsx)(c.Ay,{item:!0,xs:12,md:4,children:(0,Q.jsx)(m.A,{fullWidth:!0,placeholder:"Buscar por email, nombre o empresa...",value:le,onChange:e=>ae(e.target.value),InputProps:{startAdornment:(0,Q.jsx)(A.A,{position:"start",children:(0,Q.jsx)(F.A,{})})}})}),(0,Q.jsx)(c.Ay,{item:!0,xs:12,md:2,children:(0,Q.jsxs)(j.A,{fullWidth:!0,children:[(0,Q.jsx)(u.A,{children:"Rol"}),(0,Q.jsxs)(p.A,{value:oe,onChange:e=>te(e.target.value),label:"Rol",children:[(0,Q.jsx)(y.A,{value:"all",children:"Todos"}),(0,Q.jsx)(y.A,{value:"worker",children:"Trabajadores"}),(0,Q.jsx)(y.A,{value:"employer",children:"Empleadores"}),(0,Q.jsx)(y.A,{value:"admin",children:"Administradores"})]})]})}),(0,Q.jsx)(c.Ay,{item:!0,xs:12,md:2,children:(0,Q.jsxs)(j.A,{fullWidth:!0,children:[(0,Q.jsx)(u.A,{children:"Estado"}),(0,Q.jsxs)(p.A,{value:ne,onChange:e=>ce(e.target.value),label:"Estado",children:[(0,Q.jsx)(y.A,{value:"all",children:"Todos"}),(0,Q.jsx)(y.A,{value:"active",children:"Activos"}),(0,Q.jsx)(y.A,{value:"blocked",children:"Bloqueados"}),(0,Q.jsx)(y.A,{value:"pending",children:"Pendientes"})]})]})}),(0,Q.jsx)(c.Ay,{item:!0,xs:12,md:2,children:(0,Q.jsx)(v.A,{fullWidth:!0,variant:"outlined",startIcon:(0,Q.jsx)(_.A,{}),onClick:()=>{ae(""),te("all"),ce("all")},children:"Limpiar Filtros"})}),(0,Q.jsx)(c.Ay,{item:!0,xs:12,md:2,children:(0,Q.jsx)(v.A,{fullWidth:!0,variant:"contained",startIcon:(0,Q.jsx)(W.A,{}),onClick:()=>{const e=[["ID","Email","Nombre","Rol","Estado","Fecha Registro","Empresa","Oficio"],...r.map(e=>[e.id,e.email,e.displayName||"",e.role,e.status,e.createdAt?(0,Z.GP)(e.createdAt.toDate(),"dd/MM/yyyy"):"",e.companyName||"",e.trade||""])].map(e=>e.join(",")).join("\n"),s=new Blob([e],{type:"text/csv"}),i=window.URL.createObjectURL(s),l=document.createElement("a");l.href=i,l.download="usuarios_".concat((0,Z.GP)(new Date,"yyyyMMdd"),".csv"),l.click()},sx:{bgcolor:"#007A33"},children:"Exportar CSV"})})]})}),(0,Q.jsxs)(h.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,Q.jsx)(b.A,{sx:{maxHeight:600},children:(0,Q.jsxs)(f.A,{stickyHeader:!0,children:[(0,Q.jsx)(g.A,{children:(0,Q.jsxs)(k.A,{children:[(0,Q.jsx)(w.A,{children:"Usuario"}),(0,Q.jsx)(w.A,{children:"Rol"}),(0,Q.jsx)(w.A,{children:"Estado"}),(0,Q.jsx)(w.A,{children:"Detalles"}),(0,Q.jsx)(w.A,{children:"Registro"}),(0,Q.jsx)(w.A,{align:"center",children:"Acciones"})]})}),(0,Q.jsx)(C.A,{children:r.slice(ee*re,ee*re+re).map(e=>{var s,r;return(0,Q.jsxs)(k.A,{hover:!0,children:[(0,Q.jsx)(w.A,{children:(0,Q.jsxs)(t.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,Q.jsx)(E.A,{sx:{bgcolor:"#007A33"},children:(null===(s=e.displayName)||void 0===s?void 0:s[0])||e.email[0].toUpperCase()}),(0,Q.jsxs)(t.A,{children:[(0,Q.jsx)(n.A,{variant:"body2",fontWeight:"bold",children:e.displayName||"Sin nombre"}),(0,Q.jsx)(n.A,{variant:"caption",color:"text.secondary",children:e.email}),e.phone&&(0,Q.jsxs)(n.A,{variant:"caption",display:"block",color:"text.secondary",children:["\ud83d\udcf1 ",e.phone]})]})]})}),(0,Q.jsx)(w.A,{children:ke(e.role)}),(0,Q.jsx)(w.A,{children:we(e.status)}),(0,Q.jsxs)(w.A,{children:["worker"===e.role&&(0,Q.jsxs)(t.A,{children:[(0,Q.jsxs)(n.A,{variant:"caption",display:"block",children:["Oficio: ",e.trade||"No especificado"]}),(0,Q.jsxs)(n.A,{variant:"caption",display:"block",children:["Exp: ",e.experience||0," a\xf1os"]}),(0,Q.jsxs)(n.A,{variant:"caption",display:"block",children:["\u2b50 ",(null===(r=e.rating)||void 0===r?void 0:r.toFixed(1))||"0.0"]})]}),"employer"===e.role&&(0,Q.jsxs)(t.A,{children:[(0,Q.jsx)(n.A,{variant:"caption",display:"block",children:e.companyName||"Sin empresa"}),(0,Q.jsx)(n.A,{variant:"caption",display:"block",children:e.businessType||"No especificado"}),e.verified&&(0,Q.jsx)(a.A,{label:"Verificado",size:"small",color:"success",icon:(0,Q.jsx)(H.A,{})})]})]}),(0,Q.jsx)(w.A,{children:(0,Q.jsx)(n.A,{variant:"caption",children:e.createdAt?(0,Z.GP)(e.createdAt.toDate(),"dd/MM/yyyy",{locale:K.es}):"N/A"})}),(0,Q.jsxs)(w.A,{align:"center",children:[(0,Q.jsx)(P.A,{title:"Ver detalles",children:(0,Q.jsx)(N.A,{size:"small",onClick:()=>(e=>{xe(e),me(!0)})(e),children:(0,Q.jsx)(D.A,{})})}),"active"===e.status?(0,Q.jsx)(P.A,{title:"Bloquear",children:(0,Q.jsx)(N.A,{size:"small",color:"error",onClick:()=>ge(e,"block"),children:(0,Q.jsx)(L.A,{})})}):(0,Q.jsx)(P.A,{title:"Desbloquear",children:(0,Q.jsx)(N.A,{size:"small",color:"success",onClick:()=>ge(e,"unblock"),children:(0,Q.jsx)(z.A,{})})}),"employer"===e.role&&!e.verified&&(0,Q.jsx)(P.A,{title:"Verificar empresa",children:(0,Q.jsx)(N.A,{size:"small",color:"primary",onClick:()=>ge(e,"verify"),children:(0,Q.jsx)(H.A,{})})}),(0,Q.jsx)(P.A,{title:"Eliminar",children:(0,Q.jsx)(N.A,{size:"small",color:"error",onClick:()=>ge(e,"delete"),children:(0,Q.jsx)(U.A,{})})})]})]},e.id)})})]})}),(0,Q.jsx)(G.A,{rowsPerPageOptions:[5,10,25,50],component:"div",count:r.length,rowsPerPage:re,page:ee,onPageChange:(e,s)=>{se(s)},onRowsPerPageChange:e=>{ie(parseInt(e.target.value,10)),se(0)},labelRowsPerPage:"Filas por p\xe1gina:"})]}),(0,Q.jsxs)(S.A,{open:he,onClose:()=>me(!1),maxWidth:"md",fullWidth:!0,children:[(0,Q.jsx)(q.A,{children:"Detalles del Usuario"}),(0,Q.jsx)(B.A,{children:de&&(0,Q.jsx)(t.A,{sx:{pt:2},children:(0,Q.jsxs)(c.Ay,{container:!0,spacing:2,children:[(0,Q.jsxs)(c.Ay,{item:!0,xs:12,md:6,children:[(0,Q.jsx)(n.A,{variant:"subtitle2",color:"text.secondary",children:"Email"}),(0,Q.jsx)(n.A,{variant:"body1",gutterBottom:!0,children:de.email})]}),(0,Q.jsxs)(c.Ay,{item:!0,xs:12,md:6,children:[(0,Q.jsx)(n.A,{variant:"subtitle2",color:"text.secondary",children:"Nombre"}),(0,Q.jsx)(n.A,{variant:"body1",gutterBottom:!0,children:de.displayName||"No especificado"})]}),(0,Q.jsxs)(c.Ay,{item:!0,xs:12,md:6,children:[(0,Q.jsx)(n.A,{variant:"subtitle2",color:"text.secondary",children:"Tel\xe9fono"}),(0,Q.jsx)(n.A,{variant:"body1",gutterBottom:!0,children:de.phone||"No especificado"})]}),(0,Q.jsxs)(c.Ay,{item:!0,xs:12,md:6,children:[(0,Q.jsx)(n.A,{variant:"subtitle2",color:"text.secondary",children:"Rol"}),(0,Q.jsx)(t.A,{sx:{mt:.5},children:ke(de.role)})]}),(0,Q.jsxs)(c.Ay,{item:!0,xs:12,md:6,children:[(0,Q.jsx)(n.A,{variant:"subtitle2",color:"text.secondary",children:"Estado"}),(0,Q.jsx)(t.A,{sx:{mt:.5},children:we(de.status)})]}),(0,Q.jsxs)(c.Ay,{item:!0,xs:12,md:6,children:[(0,Q.jsx)(n.A,{variant:"subtitle2",color:"text.secondary",children:"Fecha de Registro"}),(0,Q.jsx)(n.A,{variant:"body1",gutterBottom:!0,children:de.createdAt?(0,Z.GP)(de.createdAt.toDate(),"dd/MM/yyyy HH:mm",{locale:K.es}):"N/A"})]}),"worker"===de.role&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsxs)(c.Ay,{item:!0,xs:12,md:6,children:[(0,Q.jsx)(n.A,{variant:"subtitle2",color:"text.secondary",children:"Oficio"}),(0,Q.jsx)(n.A,{variant:"body1",gutterBottom:!0,children:de.trade||"No especificado"})]}),(0,Q.jsxs)(c.Ay,{item:!0,xs:12,md:6,children:[(0,Q.jsx)(n.A,{variant:"subtitle2",color:"text.secondary",children:"Experiencia"}),(0,Q.jsxs)(n.A,{variant:"body1",gutterBottom:!0,children:[de.experience||0," a\xf1os"]})]})]}),"employer"===de.role&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsxs)(c.Ay,{item:!0,xs:12,md:6,children:[(0,Q.jsx)(n.A,{variant:"subtitle2",color:"text.secondary",children:"Empresa"}),(0,Q.jsx)(n.A,{variant:"body1",gutterBottom:!0,children:de.companyName||"No especificado"})]}),(0,Q.jsxs)(c.Ay,{item:!0,xs:12,md:6,children:[(0,Q.jsx)(n.A,{variant:"subtitle2",color:"text.secondary",children:"Tipo de Negocio"}),(0,Q.jsx)(n.A,{variant:"body1",gutterBottom:!0,children:de.businessType||"No especificado"})]})]})]})})}),(0,Q.jsx)(I.A,{children:(0,Q.jsx)(v.A,{onClick:()=>me(!1),children:"Cerrar"})})]}),(0,Q.jsxs)(S.A,{open:Ae,onClose:()=>je(!1),children:[(0,Q.jsx)(q.A,{children:"Confirmar Acci\xf3n"}),(0,Q.jsx)(B.A,{children:(0,Q.jsxs)(n.A,{children:["block"===ue&&"\xbfEst\xe1s seguro de que quieres bloquear a ".concat(null===de||void 0===de?void 0:de.email,"?"),"unblock"===ue&&"\xbfEst\xe1s seguro de que quieres desbloquear a ".concat(null===de||void 0===de?void 0:de.email,"?"),"delete"===ue&&"\xbfEst\xe1s seguro de que quieres eliminar permanentemente a ".concat(null===de||void 0===de?void 0:de.email,"? Esta acci\xf3n no se puede deshacer."),"verify"===ue&&"\xbfEst\xe1s seguro de que quieres verificar la empresa de ".concat(null===de||void 0===de?void 0:de.email,"?")]})}),(0,Q.jsxs)(I.A,{children:[(0,Q.jsx)(v.A,{onClick:()=>je(!1),children:"Cancelar"}),(0,Q.jsx)(v.A,{onClick:async()=>{if(de)try{const e=(0,O.H9)(V.db,"users",de.id);switch(ue){case"block":await(0,O.mZ)(e,{status:"blocked"}),ve({open:!0,message:"Usuario bloqueado exitosamente",severity:"success"});break;case"unblock":await(0,O.mZ)(e,{status:"active"}),ve({open:!0,message:"Usuario desbloqueado exitosamente",severity:"success"});break;case"verify":if("employer"===de.role){const e=(0,O.P)((0,O.rJ)(V.db,"employerProfiles"),(0,O._M)("userId","==",de.id)),s=await(0,O.GG)(e);s.empty||await(0,O.mZ)((0,O.H9)(V.db,"employerProfiles",s.docs[0].id),{verified:!0})}await(0,O.mZ)(e,{verified:!0}),ve({open:!0,message:"Cuenta verificada exitosamente",severity:"success"});break;case"delete":if(await(0,O.kd)(e),"worker"===de.role){const e=(0,O.P)((0,O.rJ)(V.db,"workerProfiles"),(0,O._M)("userId","==",de.id)),s=await(0,O.GG)(e);for(const r of s.docs)await(0,O.kd)(r.ref)}else if("employer"===de.role){const e=(0,O.P)((0,O.rJ)(V.db,"employerProfiles"),(0,O._M)("userId","==",de.id)),s=await(0,O.GG)(e);for(const r of s.docs)await(0,O.kd)(r.ref)}ve({open:!0,message:"Usuario eliminado exitosamente",severity:"success"})}je(!1),xe(null),be()}catch(e){console.error("Error performing action:",e),ve({open:!0,message:"Error al realizar la acci\xf3n",severity:"error"})}},color:"error",variant:"contained",children:"Confirmar"})]})]}),(0,Q.jsx)(M.A,{open:ye.open,autoHideDuration:6e3,onClose:()=>ve((0,i.A)((0,i.A)({},ye),{},{open:!1})),children:(0,Q.jsx)(R.A,{onClose:()=>ve((0,i.A)((0,i.A)({},ye),{},{open:!1})),severity:ye.severity,children:ye.message})})]})}}}]);
//# sourceMappingURL=643.a18be301.chunk.js.map